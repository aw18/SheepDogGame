<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>Sheep Dog Game</title>
        <style>
            * { padding: 0; margin: 0; }
            canvas { background: #eee; display: block; margin: 0 auto; }
        </style>
        <!-- <script defer src="src/main.js" charset="utf-8"></script> -->
    </head>
    <body style="background-color:powderblue;">
        <h1>Sheep Dog Game</h1> 
        <canvas id="boidSimulation" width="500" height="500" style="border:1px solid #000000;">
        </canvas>
        <div id="counter" style="background-color:blueviolet">
            <p style="font-size:50px;">Counter: <b id="count"></b></p>
        </div>

        <script>
            // var canvas = document.getElementById("boidSimulation");
            // var ctx = canvas.getContext("2d");
            // var x = canvas.width/2;
            // var y = canvas.height - 30;

            // var dx = 2;
            // var dy = -2;

            // function drawBall(){
            //     ctx.beginPath();
            //     ctx.arc(x, y, 10, 0, Math.PI*2);
            //     ctx.fillStyle = "#0095DD";
            //     ctx.fill();
            //     ctx.closePath();
            // }

            // function draw(){
            //     ctx.clearRect(0, 0, canvas.width, canvas.height);
            //     drawBall();
            //     x += dx;
            //     y += dy;
            // }

            var sheeps = [];
            var canvas = document.getElementById("boidSimulation");
            var ctx = canvas.getContext("2d");
            var counter = 0;

            /*
            TODO need to add vector operations
            */
            class Vector{
                constructor(originx, originy, vComp, hComp){
                    this.originx = originx;
                    this.originy = originy;
                    this.vComp = vComp;
                    this.hComp = hComp;
                }
            }

            /*
            A Boid - the boids are self organizing. Following the 3 rules:
            1. separation 
            2. alignment
            3. cohesion
            */
            class Sheep {

                // constructor
                constructor(id, xpos, ypos, radiusOfInfluence, width, height){
                    this.id = id;
                    this.xpos = xpos;
                    this.ypos = ypos;
                    this.width = width;
                    this.height = height;

                    // TODO
                    this.radiusOfInfluence = radiusOfInfluence;
                    this.direction = new Vector(0, 0, 0, 1);

                    this.image = new Image(width, height);
                    this.image.src = 'assets/straight-arrow-transparent.png';
                    this.angle = 0;

                    this.xupperleft = this.xpos - this.width/2;
                    this.yupperleft = this.ypos - this.height/2;
                }

                //  Getter 
                get radius(){
                    return this.radiusOfInfluence;
                }

                // TODO: use vector operations to calculate this.
                get angleFromVertical(){
                    return this.angle;
                }

                // Method
                print(title){
                    console.log(title);
                    console.log("id: " + this.id);
                    console.log("xpos: " + this.xpos);
                    console.log("ypos: " + this.ypos);
                    this.drawRedBall(this.xpos, this.ypos);
                    // console.log("width: " + this.width);
                    // console.log("height: " + this.height);
                    
                    console.log("angle: " + this.angle);
                    console.log("xul: " + this.xupperleft);
                    console.log("yul: " + this.yupperleft);
                    this.drawBlueBall(this.xupperleft, this.yupperleft);

                    // LATER:
                    // console.log("direction (vector): " + 
                    // this.direction.originx,
                    // this.direction.originy,
                    // this.direction.hComp, 
                    // this.direction.vComp);
                }

                drawBlueBall(x, y){
                    ctx.beginPath();
                    ctx.arc(x, y, 10, 0, Math.PI*2);
                    ctx.fillStyle = "#0095DD";
                    ctx.fill();
                    ctx.closePath();
                }

                drawRedBall(x, y){
                    ctx.beginPath();
                    ctx.arc(x, y, 10, 0, Math.PI*2);
                    ctx.fillStyle = "#FF0000";
                    ctx.fill();
                    ctx.closePath();
                }

                updateXYCoordinates(dx, dy){
                    this.xpos += dx;
                    this.ypos += dy;
                    this.xupperleft = this.xpos - this.width/2;
                    this.yupperleft = this.ypos - this.height/2;
                }

                rotate(deg){
                    ctx.translate(this.xpos, this.ypos);
                    ctx.rotate(deg * Math.PI/180);
                    console.log("angle: " + this.angle);
                }

                draw(){
                    // ctx.clearRect(0, 0, canvas.width, canvas.height);
                    this.print("--- before ----");
                    ctx.drawImage(this.image, this.xupperleft, this.yupperleft, this.image.width, this.image.height);
                    this.rotate(this.angle);
                    this.angle = (this.angle + 90) % 360;
                    // this.updateXYCoordinates(0,0);
                    // this.print("--- after ---");
                }

                // method: rotate image
                // rotate(){
                //     ctx.clearRect(0, 0, canvas.width, canvas.height);
                //     ctx.save();
                //     this.angle += 10;
                //     ctx.rotate(this.angle*Math.PI/180);
                //     this.draw();
                //     ctx.restore();
                // }
            }

            var sheep = new Sheep(1, 100, 100, 10, 50, 50);

            function main(){
                var count = document.getElementById("count");
                sheep.draw();
                count.innerText = counter;
                counter++;
            }

            // every 10 milliseconds forever
            // var int = setInterval(main, 100);
        </script>
    </body>
</html>
</html>